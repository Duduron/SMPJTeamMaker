<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>마리오 팀 랜덤 배정기</title>
  <style>
    :root{
      --gap:8px;
      --cols:11;
    }
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial; padding:20px; background:#0f172a; color:#e6eef8}
    h1{font-size:18px; margin:0 0 12px}
    h2{margin:0 0 8px;}
    .wrap{max-width:1200px; margin:0 auto}
    .grid{
      display:grid;
      grid-template-columns:repeat(var(--cols), 1fr);
      gap:var(--gap);
      align-items:stretch;
    }
    .card, .map-card{
      position:relative;
      cursor:pointer;
      overflow:hidden;
      border-radius:8px;
      background:#1e293b;
      aspect-ratio:2/1;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:600;
      color:#cbd5e1;
      font-size:14px;
      transition:all .18s;
      border:2px solid transparent;
      white-space: normal;
      text-align: center;
      line-height:1.2em;
    }
    .card.not-selected, .map-card.not-selected{
      opacity:.6;
      filter:grayscale(100%);
    }
    .card.selected, .map-card.selected{
      border-color:#0ea5a4;
      background:#0f766e;
      color:#fff;
      transform:translateY(-3px);
      box-shadow:0 6px 16px rgba(0,0,0,.4);
    }
    .team-label{position:absolute; left:6px; top:6px; padding:6px 8px; border-radius:999px; font-weight:600; color:white; font-size:13px}
    .team-blue{background:linear-gradient(90deg,#2bb0ff,#1b8fff)}
    .team-red{background:linear-gradient(90deg,#ff6b6b,#ff3b3b)}
    .controls{display:flex; gap:12px; align-items:center; margin:14px 0; flex-wrap:wrap;}
    button{background:#0b1220;color:#e6eef8;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.primary{background:#0ea5a4}
    button:disabled{opacity:.4; cursor:not-allowed}
    .info{font-size:13px; opacity:.9}
    .result{margin-top:14px; display:flex; gap:12px}
    .team-box{flex:1; padding:12px; border-radius:8px; background:rgba(255,255,255,0.04)}
    .player{display:flex; gap:8px; align-items:center; margin-bottom:8px}
    .player-name{font-weight:600}
    .small{font-size:12px; opacity:.85}
    @media (max-width:1100px){:root{--cols:6}}
    @media (max-width:700px){:root{--cols:4}}
    footer{
      margin-top:40px;
      font-size:12px;
      color:#94a3b8;
      border-top:1px solid #334155;
      padding-top:8px;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>캐릭터 4명을 선택해주세요</h2>
    <div class="controls">
      <div class="info">선택된 인원: <strong id="count">0</strong> / 4</div>
      <button id="assignBtn" class="primary" disabled>팀 랜덤 배정</button>
      <button id="resetBtn">초기화</button>
    </div>

    <div class="grid" id="grid"></div>
    <div class="result" id="result" aria-live="polite"></div>

    <!-- 맵 랜덤 선택 섹션 -->
    <div class="map-section" style="margin-top:30px;">
      <h2>맵을 선택해주세요</h2>
      <div class="grid" id="mapButtons" style="grid-template-columns:repeat(7,1fr); gap:8px;"></div>
      <button id="mapBtn" class="primary" style="margin-top:12px;">랜덤 맵 선택</button>
      <div id="mapResult" style="font-size:16px; font-weight:700; margin-top:8px;"></div>
    </div>
  </div>

  <script>
    const names = [
      '마리오','루이지','피치','데이지','와리오','와루이지','키노피오','키노피코','요시','캐서린','동키콩',
      '로젤리나','쿠파','쿠파주니어','굼바','엉금엉금','부끄부끄','헤이호','쪼루뚜','가봉','폴린','닌군'
    ];

    const grid = document.getElementById('grid');
    const countEl = document.getElementById('count');
    const assignBtn = document.getElementById('assignBtn');
    const resetBtn = document.getElementById('resetBtn');
    const result = document.getElementById('result');
    const maxSelect = 4;
    let selected = [];

    function renderGrid(){
      grid.innerHTML = '';
      names.forEach((name, idx)=>{
        const card = document.createElement('button');
        card.className = 'card not-selected';
        card.type = 'button';
        card.dataset.idx = idx;
        // '/' 기준 줄바꿈 적용
        card.innerHTML = name.replace(/\//g,'<br>');
        card.addEventListener('click', ()=>toggleSelect(idx));
        grid.appendChild(card);
      });
      updateUI();
    }

    function toggleSelect(idx){
      const pos = selected.indexOf(idx);
      if(pos >= 0){
        selected.splice(pos,1);
      } else {
        if(selected.length >= maxSelect) return;
        selected.push(idx);
      }
      updateUI();
    }

    function updateUI(){
      countEl.textContent = selected.length;
      assignBtn.disabled = (selected.length !== maxSelect);
      document.querySelectorAll('.card').forEach(card=>{
        const idx = Number(card.dataset.idx);
        card.classList.toggle('selected', selected.includes(idx));
        card.classList.toggle('not-selected', !selected.includes(idx));
        const existing = card.querySelector('.team-label');
        if(existing) existing.remove();
      });
      result.innerHTML = '';
    }

    function assignTeams(){
      if(selected.length !== maxSelect) return;
      const arr = selected.slice();
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      const blue = arr.slice(0,2);
      const red = arr.slice(2,4);

      document.querySelectorAll('.card').forEach(card=>{
        const idx = Number(card.dataset.idx);
        const existing = card.querySelector('.team-label');
        if(existing) existing.remove();
        if(blue.includes(idx)){
          const label = document.createElement('div');
          label.className = 'team-label team-blue';
          label.textContent = 'BLUE';
          card.appendChild(label);
        } else if(red.includes(idx)){
          const label = document.createElement('div');
          label.className = 'team-label team-red';
          label.textContent = 'RED';
          card.appendChild(label);
        }
      });
      renderResult(blue, red);
    }

    function renderResult(blue, red){
      result.innerHTML = '';
      const bBox = document.createElement('div'); bBox.className='team-box';
      const rBox = document.createElement('div'); rBox.className='team-box';
      const h1 = document.createElement('div'); h1.style.fontWeight='700'; h1.style.marginBottom='8px'; h1.textContent='Blue Team'; bBox.appendChild(h1);
      blue.forEach(i=>{ bBox.appendChild(makePlayer(i)); });
      const h2 = document.createElement('div'); h2.style.fontWeight='700'; h2.style.marginBottom='8px'; h2.textContent='Red Team'; rBox.appendChild(h2);
      red.forEach(i=>{ rBox.appendChild(makePlayer(i)); });
      result.appendChild(bBox); result.appendChild(rBox);
    }

    function makePlayer(idx){
      const wrap = document.createElement('div'); wrap.className='player';
      const t = document.createElement('div');
      t.innerHTML = `<div class="player-name">${names[idx].replace(/\//g,'<br>')}</div>`;
      wrap.appendChild(t);
      return wrap;
    }

    resetBtn.addEventListener('click', ()=>{
      selected = [];
      renderGrid();
      result.innerHTML = '';
    });
    assignBtn.addEventListener('click', ()=>assignTeams());
    renderGrid();

    // ================= 맵 랜덤 선택 기능 =================
    const maps = ['거대 꽃충이와/과자의 숲','주사위 스피드웨이','굼바 아일랜드','두근두근 쇼핑몰','쿠파의 데인저러스/베이스','마리오의 레인보우/캐슬','웨스턴 랜드'];
    const mapButtonsContainer = document.getElementById('mapButtons');
    const mapBtn = document.getElementById('mapBtn');
    const mapResult = document.getElementById('mapResult');

    // 맵 버튼 생성 (처음엔 모두 선택됨)
    const mapButtons = [];
    maps.forEach((mapName, idx)=>{
      const btn = document.createElement('button');
      btn.className = 'map-card selected'; // 처음부터 선택됨
      // '/' 기준 줄바꿈 적용
      btn.innerHTML = mapName.replace(/\//g,'<br>');
      btn.dataset.idx = idx;
      btn.addEventListener('click', ()=>{
        btn.classList.toggle('selected');
        btn.classList.toggle('not-selected');
      });
      mapButtons.push(btn);
      mapButtonsContainer.appendChild(btn);
    });

    // 랜덤 선택
    mapBtn.addEventListener('click', ()=>{
      const activeMaps = mapButtons.filter(b=>b.classList.contains('selected'));
      if(activeMaps.length === 0){
        mapResult.textContent = '선택 가능한 맵이 없습니다!';
        return;
      }
      const randomMap = activeMaps[Math.floor(Math.random()*activeMaps.length)];
      mapResult.textContent = `선택된 맵: ${randomMap.textContent.replace(/\n/g,'')}`;
    });
  </script>
</body>
</html>
